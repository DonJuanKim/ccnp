<h1>Dashboard#dashboard</h1>
<p></p>
<h2>Your capsule</h2>
<p></p>

<% @capsules.each do |capsule| %>
  <div>
    <div>
      <% if capsule.photos[0] %>
        <%= cl_image_tag capsule.photos[0].key, height: 300, width: 400, crop: :fill %>
      <% else %>
        <%= image_tag "capsules_default_display.jpg", height: 300, width: 400, crop: :fill %>
      <% end %>
    </div>
    <h4> <%= link_to capsule.name, capsule_path(capsule) %> </h4>
    <div>
      <% capsule.bookings.each do |booking| %>
        <li>
          Booking ID: <%= booking.id %>
          <% if booking.pending? %>
            <%= link_to "Accept", accept_capsule_booking_path(capsule, booking),  data: { turbo_method: :patch, turbo_confirm: "Are you sure you want to accept?" }%>
            <%= link_to "Decline", decline_capsule_booking_path(capsule, booking),  data: { turbo_method: :patch, turbo_confirm: "Are you sure you want to decline?" }%>
          <% else %>
            <%= booking.status %>
          <% end %>
        </li>
      <% end %>
    </div>
  </div>
<% end %>

<h2>Your bookings</h2>
<% @created_bookings.each do |booking| %>
  <div>
    <h4><%= "ID: #{booking.id} - From: #{booking.period_start} To: #{booking.period_end} - Status: #{booking.status}" %></h4>
    <div>
      <% if booking.capsule.photos[0] %>
        <%= cl_image_tag booking.capsule.photos[0].key, height: 300, width: 400, crop: :fill %>
      <% else %>
        <%= image_tag "capsules_default_display.jpg", height: 300, width: 400, crop: :fill %>
      <% end %>
    </div>
    <p><%= link_to booking.capsule.name, capsule_path(booking.capsule) %></p>
  </div>
<% end %>
